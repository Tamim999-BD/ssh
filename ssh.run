#!/bin/bash

# ===========================================
# Secure SSH Setup + Custom MOTD - SKNODES
# Professional Server Configuration
# ===========================================

clear

echo -e "\033[1;36mğŸ” SKNODES - Secure SSH Configuration\033[0m"
echo -e "\033[1;37m=====================================\033[0m"

sleep 1

echo -e "\033[1;34mâ–¶ Updating SSH configuration...\033[0m"

# Update SSH config with optimized settings
sudo bash -c 'cat <<EOF > /etc/ssh/sshd_config
# SSH SERVER CONFIGURATION - SKNODES
Port 22
Protocol 2

# AUTHENTICATION SETTINGS
PasswordAuthentication yes
PermitRootLogin yes
PubkeyAuthentication no
ChallengeResponseAuthentication no
UsePAM yes
PermitEmptyPasswords no

# SECURITY ENHANCEMENTS
X11Forwarding no
AllowTcpForwarding yes
MaxAuthTries 3
MaxSessions 10
ClientAliveInterval 300
ClientAliveCountMax 2

# LOGGING
SyslogFacility AUTH
LogLevel INFO

# SFTP SETTINGS
Subsystem sftp /usr/lib/openssh/sftp-server
EOF'

if [ $? -eq 0 ]; then
    echo -e "\033[1;32mâœ“ SSH configuration applied successfully\033[0m"
else
    echo -e "\033[1;31mâœ— Failed to update SSH configuration\033[0m"
    exit 1
fi

echo -e "\033[1;34mâ–¶ Restarting SSH service...\033[0m"
sudo systemctl restart ssh 2>/dev/null || sudo service ssh restart 2>/dev/null

if [ $? -eq 0 ]; then
    echo -e "\033[1;32mâœ“ SSH service restarted successfully\033[0m"
else
    echo -e "\033[1;33mâš  SSH service restart completed with warnings\033[0m"
fi

sleep 1

# Custom MOTD Installation
echo -e "\033[1;34mâ–¶ Installing Professional MOTD...\033[0m"

# Check if curl is available
if ! command -v curl &> /dev/null; then
    echo -e "\033[1;33mâš  curl not found, installing...\033[0m"
    sudo apt-get update && sudo apt-get install -y curl 2>/dev/null || \
    sudo yum install -y curl 2>/dev/null || \
    sudo dnf install -y curl 2>/dev/null
fi

# Install MOTD
if bash <(curl -fsSL https://raw.githubusercontent.com/Tamim999-BD/ssh/refs/heads/main/motd.run) 2>/dev/null | bash; then
    echo -e "\033[1;32mâœ“ Custom MOTD installed successfully\033[0m"
else
    echo -e "\033[1;33mâš  MOTD installation completed with warnings\033[0m"
fi

sleep 1

clear

cat << "EOF"

  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
  â•‘         â–‘â–’â–“â–ˆ SKNODES SERVER â–ˆâ–“â–’â–‘         â•‘
  â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
  â•‘    Professional Server Infrastructure     â•‘
  â•‘         Secure â€¢ Stable â€¢ Scalable        â•‘
  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–‘â–‘â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—â–‘â–‘â–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘â–‘â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•
â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•â•â–‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–‘â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–‘â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘â–‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–‘
â–‘â•šâ•â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•—â–‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–‘â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–‘â–‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â–‘â–‘â–‘â•šâ•â•â•â–ˆâ–ˆâ•—
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–‘â•šâ–ˆâ–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•
â•šâ•â•â•â•â•â•â–‘â•šâ•â•â–‘â–‘â•šâ•â•â•šâ•â•â–‘â–‘â•šâ•â•â•â–‘â•šâ•â•â•â•â•â–‘â•šâ•â•â•â•â•â•â–‘â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â–‘   
                                              
EOF

echo -e "\033[1;32mâœ“ Server configuration completed successfully\033[0m"
echo -e "\033[1;37mğŸ“‹ SKNODES VPS setup is now complete\033[0m"

echo -e "\n\033[1;33mâš  SECURITY ADVISORY:\033[0m"
echo -e "\033[1;37mâ€¢ Change the default SSH port for enhanced security\033[0m"
echo -e "\033[1;37mâ€¢ Consider using SSH keys for authentication\033[0m"
echo -e "\033[1;37mâ€¢ Regularly update your server packages\033[0m"

echo -e "\n\033[1;36mâ–¶ Please set your ROOT password:\033[0m"
sudo passwd root

echo -e "\n\033[1;35mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\033[0m"
echo -e "\033[1;36mâœ¨ SKNODES Professional Server Ready! âœ¨\033[0m"
echo -e "\033[1;37mğŸ”— Connect: ssh root@$(curl -s ifconfig.me 2>/dev/null || hostname -I | awk '{print $1}')\033[0m"
echo -e "\033[1;37mğŸ“Š Monitor: htop, nmon, netstat, vnstat\033[0m"
echo -e "\033[1;35mâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\033[0m"

# Display server info
echo -e "\n\033[1;34mğŸ“Š SERVER INFORMATION:\033[0m"
echo -e "\033[1;37mHostname: \033[1;36m$(hostname)\033[0m"
echo -e "\033[1;37mIP Address: \033[1;36m$(hostname -I | awk '{print $1}')\033[0m"
echo -e "\033[1;37mUptime: \033[1;36m$(uptime -p | sed 's/up //')\033[0m"
echo -e "\033[1;37mOS: \033[1;36m$(grep PRETTY_NAME /etc/os-release | cut -d'"' -f2)\033[0m"
